<!DOCTYPE html>
<html>
<head>
    <title>Composition</title>
</head>
<body>
    <textarea id="editor" name="editor"></textarea>
    <div id="content-storage" style="display: none;">
        <p />
        <div id="signature"></div>
        {{HEADER}}
        {{QUOTE}}
    </div>

    <!-- ReSharper disable Html.PathError -->
    <script type="text/javascript" src="Resources/jquery/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="Resources/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="Resources/ckeditor/adapters/jquery.js"></script>
    <!-- ReSharper restore Html.PathError -->

    <script type="text/javascript">
        // Module pattern: https://github.com/stevekwan/experiments/blob/master/javascript/module-pattern.html

        var Crystalbyte = Crystalbyte || {};
        Crystalbyte.Paranoia = function () {
            var textarea = $('textarea#editor');

            var loadContent = function () {
                var storage = $('#content-storage');
                storage.show();

                textarea.val(storage.html());
                storage.remove();

                resizeEditor();
            }

            var resizeEditor = function () {
                var w = $(window);
                var height = w.height();
                var width = w.width();
                textarea.editor.resize(width, height, false);
            }

            var focusEditor = function () {
                var editor = textarea.editor;
                editor.focus();
            }

            var getComposition = function () {
                return textarea.val();
            }

            var setReadOnly = function (readOnly) {
                var editor = textarea.editor;
                editor.setReadOnly(readOnly);
            }

            var insertText = function (text) {
                var editor = textarea.editor;
                editor.insertText(text);
            }

            var insertHtml = function (html) {
                var editor = textarea.editor;
                editor.insertHtml(html);
            }

            var setComposition = function(html) {
                textarea.val(html);
            }

            var execute = function (command) {
                var editor = textarea.editor;
                editor.execCommand(command);
            }

            var init = function () {
                textarea.ckeditor(Crystalbyte.Paranoia.loadContent, {
                    font_defaultLabel: '{{DEFAULT_FONT_FAMILY}}',
                    fontSize_defaultLabel: '{{DEFAULT_FONT_SIZE}}',
                });
            }

            return {
                init: init,
                execute: execute,
                insertHtml: insertHtml,
                insertText: insertText,
                setReadOnly: setReadOnly,
                loadContent: loadContent,
                focusEditor: focusEditor,
                resizeEditor: resizeEditor,
                getComposition: getComposition,
                setComposition: setComposition,
            };
        }();

        $(window).resize(Crystalbyte.Paranoia.resizeEditor);
        $(document).ready(function () {
            Crystalbyte.Paranoia.init();
        });
    </script>
</body>
</html>
