<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Composition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            border: 0;
        }
    </style>
</head>
<body>
    <textarea id="editor" name="editor"></textarea>
    <div id="content-storage" style="display: none;">%CONTENT%</div>

    <!-- ReSharper disable Html.PathError -->
    <script type="text/javascript" src="Resources/jquery/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="Resources/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="Resources/ckeditor/adapters/jquery.js"></script>
    <!-- ReSharper restore Html.PathError -->

    <script type="text/javascript">
        // Module pattern: https://github.com/stevekwan/experiments/blob/master/javascript/module-pattern.html

        var Crystalbyte = Crystalbyte || {};
        Crystalbyte.Paranoia = function () {
            var textarea = $('textarea#editor');

            var loadContent = function () {
                var storage = $('#content-storage');
                textarea.val(storage.html());
                storage.remove();
            }

            var resizeEditor = function () {
                var w = $(window);
                var height = w.height();
                var width = w.width();
                textarea.editor.resize(width, height, false);
            }

            var focusEditor = function () {
                textarea.focus();
            }

            var getComposition = function () {
                var editor = textarea.editor;
                return editor.getData();
            }

            var setReadOnly = function (readOnly) {
                var editor = textarea.editor;
                editor.setReadOnly(readOnly);
            }

            var insertText = function (text) {
                var editor = textarea.editor;
                editor.insertText(text);
            }

            var insertHtml = function (html) {
                var editor = textarea.editor;
                editor.insertHtml(html);
            }

            var execute = function (command) {
                var editor = textarea.editor;
                editor.execCommand(command);
            }

            var init = function () {
                textarea.ckeditor(Crystalbyte.Paranoia.loadContent, {
                    toolbar: [
                    { name: 'document', items: ['Undo', 'Redo', 'Font', 'FontSize'] },
                    { name: 'document1', items: ['Bold', 'Italic', 'Underline', 'Strike', 'Subscript', 'Superscript', 'TextColor', 'BGColor'] },
                    { name: 'document2', groups: ['justify', 'mode'], items: ['JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock', 'NumberedList', 'BulletedList', '-', 'Image', 'Link', 'Table', 'Source'] }]
                });
            }

            return {
                init: init,
                execute: execute,
                insertHtml: insertHtml,
                insertText: insertText,
                setReadOnly: setReadOnly,
                loadContent: loadContent,
                focusEditor: focusEditor,
                resizeEditor: resizeEditor,
                getComposition: getComposition,
                defaultFontSize: "%DEFAULT_FONT_SIZE%",
                defaultFontFamily: "%DEFAULT_FONT_FAMILY%",
            };
        }();

        $(window).resize(Crystalbyte.Paranoia.resizeEditor);
        $(document).ready(function () {
            Crystalbyte.Paranoia.init();
        });
    </script>
</body>
</html>
